/*! game 17-06-2013 */
if(function(t){var e={};e.createMulticall=function(){var t=[],i=[],s=function(){for(var e=!1,s=0,n=t.length;n>s;++s)t[s]!==void 0&&(e=t[s].apply(i[s]||this,arguments)||e);return e};s.listeners=this,s.contexts=this,s.add=function(e,s){return t.push(e),i.push(s||null),this},s.remove=function(s,n){if(s||n){for(var r=-1,h=t.length;--h>=0;){var o=t[h],a=i[h];if(n&&a===n&&o===s){r=h;break}if(!n&&s===o){r=h;break}}r>-1&&(e.removeElement(t,h),e.removeElement(i,h))}else t.length=0,i.length=0;return this};for(var n=0,r=arguments.length-1;r>=n;++n)s.add(arguments[n]);return s},e.delimit=function(t){for(var e=""+t,i="",s=e.length;s>=0;s-=3){var n=s-3,r=0===i.length;if(0>=n){r||(i=","+i),i=e.substring(0,n+3)+i;break}r||(i=","+i),i=e.substr(n,3)+i}return i},e.removeElement=function(t,e){var i,s=0;if(Array.prototype.indexOf)s=t.indexOf(e);else for(s=0,i=t.length;i>s&&t[s]!==e;++s);t.splice(s,1)},e.shuffle=function(t,e){var i=[].concat(t);"function"!=typeof e&&(e=function(){return Math.random()});for(var s=i.length;--s>=1;){var n=Math.round(e()*s),r=i[s];i[s]=i[n],i[n]=r}return i},e.ease=function(t,i){var s=[];for(var n in i)if(i.hasOwnProperty(n)){var r=t[n],h=i[n],o=!1,a=!1;if(r!==h){if(+h===h)r=+r||0,h=+h;else if(""+h===h){try{var c=e.parseColor(h);c&&(h=c,r=e.parseColor(r)||[0,0,0,1],a=!0)}catch(l){a=!1}a||(o=!0)}else o=!0;var u={key:n,source:r,dest:h,isColor:a,isSet:o};s.push(u)}}return function(t,i){for(var n=0,r=s.length;r>n;++n){var h,o=s[n];h=o.isColor?e.mixColors(o.source,o.dest,i):o.isSet?1===i?o.dest:o.source:o.source*(1-i)+o.dest*i,t[o.key]=h}}},e.checkAABBIntersection=function(t,e){for(var i=e.x,s=e.x+e.width,n=e.y,r=e.y+e.height,h=[[t.x,t.y],[t.x+t.width,t.y],[t.x,t.y+t.height],[t.x+t.width,t.y+t.height]],o=0;4>o;++o){var a=h[o],c=a[0],l=a[1];if(c>=i&&s>=c&&l>=n&&r>=l)return!0}return!1},e.extendTo=function(t,e){function i(){}function s(){var i,s=this["super"];return this["super"]=t,i=e.apply(this,arguments),s&&(this["super"]=s),i}return s.toString=function(){return e.toString.call(this)},i.prototype=t.prototype,i.prototype.constructor=t,s.prototype=new i,s.prototype.constructor=s,s},e.toRadix=function(t,e){for(var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",s=[];t>0;){var n=t%e;t=Math.floor(t/e),s.unshift(i[n])}return s.join("")},e.isArray=function(t){return"[object Array]"==Object.prototype.toString.call(t)},e.mixColors=function(t,i,s){e.isArray(t)||(t=e.parseColor(t)),e.isArray(i)||(i=e.parseColor(i));for(var n=1-s,r=[],h=0;3>h;++h)r[h]=Math.min(255,Math.max(0,Math.round(t[h]*n+i[h]*s||0)));return r[h]=Math.min(1,Math.max(0,t[3]*n+i[3]*s||0)),"rgba("+r.join(",")+")"},e.parseColor=function(t){var e=[],i=!1;if(t=t.trim(),0===t.indexOf("rgba")?(t=t.substring(4),i=!0):0===t.indexOf("rgb")&&(t=t.substring(3),i=!0),i){t=t.replace("(",""),t=t.replace(")","");for(var s=t.split(","),n=0;s.length>n;++n)e[n]=parseFloat(s[n].trim())}else{if(0!==t.indexOf("#"))return!1;for(var s=t.match(/[0-9a-f]{2}/g),n=0;s.length>n;++n)e[n]=parseInt(s[n].trim(),16)}return 3===e.length&&e.push(1),e},e.applyDefaults=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t.hasOwnProperty(i)||(t[i]=e[i]));return t};var i=function i(){return this._bindings={},this};i.prototype.on=function(t,i,s){this._bindings||(this._bindings={});var n=this._bindings[t]||e.createMulticall();return this._bindings[t]=n.add(i,s),this},i.prototype.once=function(t,i,s){function n(){return r.remove(n,s),i.apply(s||this,Array.prototype.slice.call(arguments,0))}this._bindings||(this._bindings={});var r=this._bindings[t]||e.createMulticall();return this._bindings[t]=r.add(n,s),this},i.prototype.off=function(t,e,i){this._bindings||(this._bindings={});var s=this._bindings[t];return s&&s.remove(e,i),this},i.prototype.trigger=function(t){this._bindings||(this._bindings={});var e=this._bindings[t],i=void 0;return e&&(i=e.call(this,arguments[1],arguments[2],arguments[3])),i},t.Utils=e,t.Events=i}("undefined"!=typeof exports?exports:window),function(t,e){function i(t,e){return function(){return t.apply(e,Array.prototype.slice.call(arguments,0))}}for(var s=0,n=["ms","moz","webkit","o"],r=0;n.length>r&&!e.requestAnimationFrame;++r)e.requestAnimationFrame=e[n[r]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[n[r]+"CancelAnimationFrame"]||e[n[r]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=function(t){var i=+new Date,n=Math.max(0,15-(i-s)),r=e.setTimeout(function(){var e=+new Date;t(e)},2);return s=i+n,r},e.cancelAnimationFrame=function(t){clearTimeout(t)});var h=function h(t){return this._currentTime=0,this._callback=t,this};h.prototype.setCallback=function(t){this._callback=t},h.prototype.currentTime=function(){return this._currentTime},h.prototype.advance=function(t,e){this._currentTime+=t,this._callback(t,e)};var o=Utils.extendTo(h,function(t,e){return this["super"](t),this._maxAdvance=e||o.DEFAULT_MAX_ADVANCE,this._running=!1,this._lastTimestamp=0,this._nextRequest=0,this});o.DEFAULT_MAX_ADVANCE=100,o.prototype.start=function(){this._running||(this._running=!0,this._nextRequest=e.requestAnimationFrame(i(this._nextFrame,this)))},o.prototype.stop=function(){this._running=!1,e.cancelAnimationFrame(this._nextRequest),delete this._nextRequest},o.prototype._nextFrame=function(t){var s=this;if(this._lastTimestamp){var n=t-this._lastTimestamp;this._lastTimestamp=t,this.advance(Math.min(~~(n+.5),this._maxAdvance),function(){s._running&&(s._nextRequest=e.requestAnimationFrame(i(s._nextFrame,s)))})}else this._lastTimestamp=t,this._running&&(this._nextRequest=e.requestAnimationFrame(i(this._nextFrame,this)))},t.ClockTimer=o,t.Timer=h}("undefined"!=typeof exports?exports:window,"undefined"!=typeof window?window:exports),function(t){var e={};e.easeLinear=function(t){return t},e.easeCubic=function(t){return t*t*t},e.easeOutBounce=function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},e.easeOut=function(t){return t-=1,t*t*t+1},e.easeIn=function(t){return t=1-t,1-t*t*t},e.easeOvershoot=function(t){return 2.5*-t*(t-1.4)},e.easeRebound=function(t){return 1-(2*t-1)*(2*t-1)},t.Easing=e}("undefined"!=typeof exports?exports:window),"undefined"!=typeof require){var fs=require("fs"),utils=require("./utils.js");Utils=utils.Utils}if(function(t){var e=function(){this._cache={}};e.prototype.spritesheet=function(t,e,i){for(var s=new Image,n=this,r=0;e.length>r;++r){var h=e[r],o=this._cache[h.url];o===void 0&&(o={},o.callback=Utils.createMulticall(),o.pending=!0,this._cache[h.url]=o),i&&o.callback.add(i)}s.addEventListener("load",function(){for(var t=0;e.length>t;++t){var i=e[t],r=n._cache[i.url];r.pending=!1,r.img=s,r.x=i.x,r.y=i.y,r.width=i.width,r.height=i.height,r.callback(r,i.url)}},!1),s.addEventListener("error",function(){for(var t=0;e.length>t;++t){s.pending=!1;var i=e[t],s=n._cache[i.url];s.pending=!1,s.error=!0,s.callback(null,i.url)}},!1),s.src=t},e.prototype.image=function(t,e){var i=this._cache[t];e=e||function(){},i===void 0&&(i={},i.callback=Utils.createMulticall(),this._cache[t]=i);var s=i.img;return i.pending?e&&i.callback.add(e):s===void 0?(s=new Image,i.img=s,e&&i.callback.add(e),fs!==void 0?fs.readFile(__dirname+t,function(e,n){i.pending=!1,e?(i.error=!0,i.callback(null,t)):(s.src=n,i.x=0,i.y=0,i.width=s.width,i.height=s.height,i.callback(i,t))}):(i.pending=!0,i.img=s,s.addEventListener("load",function(){i.pending=!1,i.x=0,i.y=0,i.width=s.width,i.height=s.height,i.callback(i,t)},!1),s.addEventListener("error",function(){i.pending=!1,i.error=!0,i.callback(null,t)},!1),s.src=t)):(i.error&&(i=null),e&&e(i,t)),i&&!i.pending?i:null},t.Resources=e}("undefined"!=typeof exports?exports:window),"undefined"!=typeof require){var utils=require("./utils.js");Utils=utils.Utils,Events=utils.Events}(function(t){var e=0,i=Utils.extendTo(Events,function(t,e,i){this["super"](),e=e||{};var s=e.requires,n=e.defaults,r={},h={};for(var o in e)if(e.hasOwnProperty(o))if(0==o.indexOf("on")){var a=o.substring(2);r[a]=e[o]}else h[o]=e[o];return this._definition=e,this._name=t,this._objectListCache=[],this._objects={},this._objectsDirty=!0,this.engine=i,this.requires=s||[],this.defaults=n,this.listeners=r,this.methods=h,this});i.prototype.copy=function(t){return new i(this._name,this._definition,t)},i.prototype.applyBehaviour=function(t,e){var i=this.methods,s=this.listeners;this._objectsDirty=!0,this._objects[t.id]=t;for(var n in i)i.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=i[n]);t._boundListeners=t._boundListeners||{};for(var r in s){var h=this._name+"."+r;if(s.hasOwnProperty(r)&&!t._boundListeners[h]){t._boundListeners[h]=!0;var o=s[r];t.on(r,o,t)}}this.defaults&&Utils.applyDefaults(t,this.defaults);for(var a=0,c=this.requires.length;c>a;++a){var l=this.requires[a];t.hasBehaviour(l)||t.addBehaviour(l)}return"function"==typeof i.init&&e&&i.init.call(t),this},i.prototype.removeBehaviour=function(t){var e=this.methods,i=this.listeners;this._objectsDirty=!0,delete this._objects[t.id];for(var s in e)e.hasOwnProperty(s)&&t[s]===e[s]&&delete t[s];t._boundListeners=t._boundListeners||{};for(var n in i){var r=this._name+"."+n;i.hasOwnProperty(n)&&t._boundListeners[r]&&(t._boundListeners[r]=!1,t.off(n,i[n],t))}return"function"==typeof e.destroy&&e.destroy.call(t),this},i.prototype.hookupChild=function(t){this._objects.hasOwnProperty(t.id)||(this._objectsDirty=!0,this._objects[t.id]=t)},i.prototype.unhookChild=function(t){this._objects.hasOwnProperty(t.id)&&(this._objectsDirty=!0,delete this._objects[t.id])},i.prototype.getObjects=function(){if(this._objectsDirty){this._objectsDirty=!1,this._objectListCache=[];for(var t in this._objects)this._objects.hasOwnProperty(t)&&this._objectListCache.push(this._objects[t])}return this._objectListCache},i.prototype.getName=function(){return this._name};var s=Utils.extendTo(Events,function(t,e,i){if(this["super"](),this._behaviours={},this._children=[],this._times={},this._updating=!1,this._pendingRemoves=[],this._pendingAdds=[],this.engine=i,this.active=!0,this.id=s.getNextId(),this.tag=null,e){var n={};for(var r in e)if(e.hasOwnProperty(r))if(0==r.indexOf("on")){var h=r.substring(2);this.on(h,e[r])}else n[r]=e[r],this[r]=e[r];this.savedDefaults=n}if(this.dx=this.dx||0,this.dy=this.dy||0,this.x=this.x||0,this.y=this.y||0,t)for(var o=0,a=t.length;a>o;++o)this.addBehaviour(t[o]);return this.on("attach",function(t){var e=this._children;if(e.length>0){e=[].concat(e);for(var i=0,s=e.length;s>i;++i){var n=e[i];n.engine!=t&&(n.engine=t,n.trigger("attach",t))}}}),this.on("subtick",function(t){var e=this._children;if(this._updating=!0,+new Date,e.length>0){e=[].concat(e);for(var i=0,s=e.length;s>i;++i){var n=e[i];n.active&&n.trigger("subtick",t)}}+new Date,this.trigger("tick",t),+new Date,this._updating=!1;for(var i=0,s=this._pendingRemoves.length;s>i;++i)this.removeChild(this._pendingRemoves[i]);for(var i=0,s=this._pendingAdds.length;s>i;++i)this.addChild(this._pendingAdds[i]);this._pendingRemoves=[],this._pendingAdds=[],this.sortOnTick&&this._children.sort(function(t,e){return~~t.z-~~e.z}),+new Date}),this.on("touchstart",function(t,e,i){if(!this.disabled){var s=this._children,n=!1;t-=~~this.x,e-=~~this.y,t/=this.scaleX||1,e/=this.scaleY||1,t-=~~this.offsetX,e-=~~this.offsetY;for(var r=s.length-1;r>=0;--r){var h=s[r];if(n=h.trigger("touchstart",t,e,i)||i.cancelled){i.cancelled=!0;break}}return n}}),this.on("touchmove",function(t,e,i){if(!this.disabled){var s=this._children,n=!1;t-=~~this.x,e-=~~this.y,t/=this.scaleX||1,e/=this.scaleY||1,t-=~~this.offsetX,e-=~~this.offsetY;for(var r=s.length-1;r>=0;--r){var h=s[r];if(n=h.trigger("touchmove",t,e,i)||i.cancelled){i.cancelled=!0;break}}return n}}),this.on("touchend",function(t,e,i){if(!this.disabled){var s=this._children,n=!1;t-=~~this.x,e-=~~this.y,t/=this.scaleX||1,e/=this.scaleY||1,t-=~~this.offsetX,e-=~~this.offsetY;for(var r=s.length-1;r>=0;--r){var h=s[r];if(n=h.trigger("touchend",t,e,i)||i.cancelled){i.cancelled=!0;break}}return n}}),this.on("subrender",function(t){game.breakOn===this.id&&(game.breakOn=game.breakOn),+new Date;var e,i,s=this._children,n=!1,r=~~this.x-~~this.centerX,h=~~this.y-~~this.centerY,o=~~this.offsetX,a=~~this.offsetY,c=!1,l=!1;if(this.compositeOperation!==void 0&&(l=!0,i=t.globalCompositeOperation||"source-over",t.globalCompositeOperation=this.compositeOperation),this.alpha!==void 0&&1!==this.alpha&&(c=!0,e=t.globalAlpha,t.globalAlpha=this.alpha*e),(this.scaleX!==void 0&&1!==this.scaleX||this.scaleY!==void 0&&1!==this.scaleY||this.rotation!==void 0)&&(n||(n=!0,t.save()),t.translate(r+~~this.centerX,h+~~this.centerY),(this.scaleX!==void 0&&1!==this.scaleX||this.scaleY!==void 0&&1!==this.scaleY)&&t.scale(this.scaleX!==void 0?this.scaleX:1,this.scaleY!==void 0?this.scaleY:1),this.rotation&&t.rotate(this.rotation)),n&&t.translate(-r-~~this.centerX,-h-~~this.centerY),this.clip&&(n||(n=!0,t.save()),t.beginPath(),t.rect(~~this.x,~~this.y,~~this.width,~~this.height),t.closePath(),t.clip()),+new Date,this.trigger("render",t),+new Date,n&&t.translate(r,h),s.length>0){if(n){var u=o+~~this.centerX,d=a+~~this.centerY;(0!==u||0!==d)&&t.translate(o+~~this.centerX,a+~~this.centerY)}else{var u=r+o+~~this.centerX,d=h+a+~~this.centerY;(0!==u||0!==d)&&(n=!0,t.save(),t.translate(r+o+~~this.centerX,h+a+~~this.centerY))}s=[].concat(s);for(var f=0,g=s.length;g>f;++f){var v=s[f],p=v.y||0,m=p+~~v.height;if(this.clip){if(-a>m)continue;if(p>this.height-a)continue}v.trigger("subrender",t)}}n&&t.restore(),+new Date,l&&(t.globalCompositeOperation="source-over"),c&&(t.globalAlpha=e)}),this.on("gizmos",function(t){var e=this._children;if(e.length>0){var i=!1,s=~~this.x,n=~~this.y;~~this.centerX,~~this.centerY,(0!==~~s||0!==~~n)&&(i||(i=!0,t.save()),t.translate(s,n)),this.rotation&&(i||(i=!0,t.save()),t.rotate(this.rotation));for(var r=0,h=e.length;h>r;++r){var o=e[r];o.trigger("gizmos",t)}i&&t.restore()}}),this.on("gizmos",function(t){if(t.strokeStyle="#0000ff",t.lineWidth=1,this.x!==void 0&&this.y!==void 0&&this.width&&this.height){var e=this.x,i=this.y;this.rotation&&(t.save(),t.translate(e,i),t.rotate(this.rotation),e=0,i=0),this.centerX&&(e-=this.centerX),this.centerY&&(i-=this.centerY),t.strokeRect(e,i,this.width,this.height),this.rotation&&t.restore(),t.fillStyle="#0000ff",t.strokeStyle="#0000ff",t.lineWidth=2,t.beginPath(),t.arc(this.x,this.y,4,0,2*Math.PI,!1),t.fill(),t.beginPath(),t.moveTo(this.x,this.y),t.lineTo(this.x+this.dx/20,this.y+this.dy/20),t.closePath(),t.stroke(),t.closePath(),t.font="24px sans-serif",t.fillText(this.id,this.x-~~this.centerX+10,this.y-~~this.centerY+30)}}),e&&"function"==typeof e.init&&e.init.call(this),this});s.prototype.trackEvent=function(t,e,i){var s=[e,t].join("."),n=this._times[s],r=i;n&&(r=(n+i)/2),this._times[s]=r},s.prototype.trackTime=function(t,e){var i=this._times[t],s=e;i&&(s=(i+e)/2),this._times[t]=s},s.prototype.boundingBox=function(){var t=~~this.x-~~this.centerX,e=~~this.y-~~this.centerY;return{x:t,y:e,width:this.width,height:this.height}},s.prototype.debugLog=function(t,e){function i(t,e){return t*=Math.pow(10,e),t=Math.round(t),t/=Math.pow(10,e)}var s="",n=[],r=this.tag?this.tag+"("+this.id+")":this.id;e=e||[];var h=[];for(var o in this._times)if(this._times.hasOwnProperty(o)){h.push(o);for(var a=!1,c=0;e.length>c;++c)if(e[c]===o){a=!0;break}a||e.push(o)}n.push(r),n.push(t||"");for(var c=0;e.length>c;++c)this._times.hasOwnProperty(h[c])?n.push(i(this._times[h[c]],3)):n.push("");s+=n.join("	")+"\n";var l=this._children;if(l.length>0){l=[].concat(l);for(var c=0,u=l.length;u>c;++c){var d=l[c];s+=d.debugLog(r,e)}}if(!t){for(var f=["Name","Parent"],c=0;e.length>c;++c)f.push(e[c]);s=f.join("	")+"\n"+s}return s},s.prototype.debugLog2=function(t){function e(t,e){return t*=Math.pow(10,e),t=Math.round(t),t/=Math.pow(10,e)}t=t||"";var i=[],s=this.tag?this.tag+"("+this.id+")":this.id,n=[];for(var r in this._times)this._times.hasOwnProperty(r)&&n.push(r);if(!t){for(var h=["Name","Parent"],o=0;n.length>o;++o)h.push(n[o]);console.log(h.join("	"))}i.push(s),i.push(t);for(var o=0;n.length>o;++o)i.push(e(this._times[n[o]],3));console.log(i.join("	"));var a=this._children;if(a.length>0){a=[].concat(a);for(var o=0,c=a.length;c>o;++o){var l=a[o];l.debugLog(s)}}},s.prototype.addModal=function(t){var e=this;e.disabled=!0,t.on("completed",function(){e.disabled=!1,t.remove()}),this.parent.addChild(t)},s.getNextId=function(){return Utils.toRadix(++e,36)},s.prototype.setTag=function(){return this.tag=tag,this},s.prototype.getTag=function(){return this.tag||this.id},s.prototype.addBehaviour=function(t){var e;e=""+t===t?this.engine.behaviour(t):t;var i=e.getName();return this._behaviours.hasOwnProperty(i)||(this._behaviours[i]=e,e.applyBehaviour(this,!0)),this},s.prototype.removeBehaviour=function(t){var e;return""+t!==t&&(t=t.getName()),this._behaviours.hasOwnProperty(t)&&(e=this._behaviours[t],e.removeBehaviour(this),delete this._behaviours[t]),this},s.prototype.hasBehaviour=function(t){return this._behaviours.hasOwnProperty(t)},s.prototype.getBehaviours=function(){var t=[];for(var e in this._behaviours)this._behaviours.hasOwnProperty(e)&&t.push(e);return t},s.prototype.remove=function(){this.parent&&this.parent.removeChild(this,!0)},s.prototype.removeAllChildren=function(){for(var t=[].concat(this._children),e=0;t.length>e;++e)t[e].remove()},s.prototype.bringToFront=function(){if(this.parent){var t=this.parent;t.removeChild(this,!1),t.addChild(this)}},s.prototype.addChild=function(t){if(t.parent&&t.parent.removeChild(t,!1),t.parent=this,this._children.push(t),!t.engine&&this.engine){for(var e in t._behaviours){var i=t._behaviours[e];i.hookupChild(t)}t.engine=this.engine,t.trigger("attach",this.engine)}return t.engine&&t.engine._addObject(t),this.trigger("childAdded",t),this},s.prototype.indexOfChild=function(t){for(var e=0;this._children.length>e;++e)if(this._children[e]===t)return e;return null},s.prototype.insertChild=function(t,e){return t.parent&&t.parent.removeChild(t,!1),t.parent=this,this._children.splice(e,0,t),!t.engine&&this.engine&&(t.engine=this.engine,t.trigger("attach",this.engine)),t.engine&&t.engine._addObject(t),this.trigger("childAdded",t),this},s.prototype.children=function(){return this._children},s.prototype.removeChild=function(t,e){if(t.parent===this){if(t.parent=null,Utils.removeElement(this._children,t),t.engine&&e){t.engine.removeObject(t);for(var i=[].concat(t._children),s=0,n=i.length;n>s;++s)t.removeChild(i[s],e);t._children=[];for(var r in t._behaviours){var h=t._behaviours[r];h.unhookChild(t),h.removeBehaviour(t)}}return this.trigger("childRemoved",t),this}},s.prototype.delay=function(t,e){function i(h){r||(n+=h,n>=t&&(r=!0,n=t),r&&(s.off("tick",i),e&&e.call(s)))}var s=this,n=0,r=!1;this.on("tick",i)},s.prototype.ease=function(t,e,i,s){function n(t){if(!o){h+=t,h>=e&&(o=!0,h=e);var c=h/e;c=Math.min(Math.max(c,0),1);var l=i(c);a(r,l),o&&(r.off("tick",n),s&&s.call(r))}}var r=this,h=0,o=!1,a=Utils.ease(this,t||this.savedDefaults);i=i||Easing.easeLinear,this.on("tick",n)},t.Behaviour=i,t.GameObject=s})("undefined"!=typeof exports?exports:window),function(t){var e=new Behaviour("mass",{ontick:function(t){this.dy+=this.engine.gravity*t,this.x+=this.dx*t,this.y+=this.dy*t},ongizmos:function(){},applyForce:function(t,e){this.dx+=t,this.dy+=e}});t.Mass=e}("undefined"!=typeof exports?exports:window),function(t){var e=new Behaviour("accelerometer",{ontick:function(){(this.engine.accelerationX||this.engine.accelerationY||this.engine.accelerationZ)&&(this.accelerationX=this.engine.accelerationX,this.accelerationY=this.engine.accelerationY,this.accelerationZ=this.engine.accelerationZ,this.smoothAccelerationX=this.engine.smoothAccelerationX,this.smoothAccelerationY=this.engine.smoothAccelerationY,this.smoothAccelerationZ=this.engine.smoothAccelerationZ)}}),i=new Behaviour("orientation",{ontick:function(){this.engine.orientation&&(this.orientation={alpha:this.engine.orientation.alpha,beta:this.engine.orientation.beta,gamma:this.engine.orientation.gamma})}});t.Accelerometer=e,t.Orientation=i}("undefined"!=typeof exports?exports:window),function(t){var e=80,i=new Behaviour("button",{requires:["sprite"],init:function(){this.updateState()},isInBounds:function(t,i,s){var n=this.x-~~this.centerX-(s?e:0),r=this.y-~~this.centerY-(s?e:0),h=t-n,o=i-r;return h>=0&&~~this.width+(s?2*e:0)>h&&o>=0&&~~this.height+(s?2*e:0)>o?!0:!1},updateState:function(){var t=this.wasDown;this.wasDown=this.isDown,this.url=this.isDown?this.pressedUrl:this.unpressedUrl,!!t!=!!this.isDown&&this.trigger("stateChanged",this.isDown)},ontouchstart:function(t,e){return this.disabled?void 0:(this.isInBounds(t,e)?(this.isDown=!0,this.touched=!0):(this.isDown=!1,this.touched=!1),this.updateState(),this.isDown)},ontouchmove:function(t,e){return this.disabled?void 0:(this.isInBounds(t,e,!0)?this.touched&&(this.isDown=!0):this.isDown=!1,this.updateState(),this.touched)},ontouchend:function(t,e){var i=this.touched;return this.touched=!1,this.isInBounds(t,e,!0)||(this.isDown=!1),this.isDown&&(this.isDown=!1,this.updateState(),this.disabled||this.trigger("click",t,e)),i}});t.GameButton=i}("undefined"!=typeof exports?exports:window),function(t){var e=new Behaviour("sprite",{defaults:{scaleX:1,scaleY:1},init:function(){var t=this;this.align&&this.on("loaded",function(){"center"===this.align&&(t.centerX=t.width/2,t.centerY=t.height/2)})},onrender:function(t){var e,i=this;if(this.url&&(!this.cachedImage||this.cachedUrl!==this.url)){var s=!1;this.engine.resources.image(this.url,function(t,e){t&&(s=!0,i.cachedImage=t,i.cachedUrl=e,i.width=i.width||t.width,i.height=i.height||t.height,i.srcwidth=t.width,i.srcheight=t.height,i.trigger("loaded"))})}this.cachedImage&&(e=this.cachedImage.img);var n=~~(this.x+.5),r=~~(this.y+.5);if(e){var o=this.width||(this.res?this.res.width:0),a=this.height||(this.res?this.res.height:0);this.crop?(w=this.width,h=this.height):(w=this.srcwidth,h=this.srcheight),t.drawImage(e,(this.offsetX||0)+this.cachedImage.x,(this.offsetY||0)+this.cachedImage.y,w,h,n-~~this.centerX,r-~~this.centerY,o,a)}}});t.Sprite=e}("undefined"!=typeof exports?exports:window),function(t){var e=new Behaviour("text",{defaults:{scaleX:1,scaleY:1,rotation:0,align:"left"},setText:function(t){this.text=t},getLetterUrl:function(t){return t+".png"},getKerning:function(){return~~this.kerning},transformLetter:function(t){switch(/[A-Z]/.test(t)&&(t="u"+t.toLowerCase()),t){case"!":return"exclamation";case":":return"colon";case".":return"period";case",":return"comma";case"-":return"hyphen";case" ":return"space";default:return t}},measure:function(){var t=0,e=0,i=!0,s=this.getLetterUrl("period"),n=this.getKerning("period"),r=3*(s.width||0)+3*n,h=this.fixedWidth?this.fixedWidth:Number.MAX_VALUE,o=this.fixedWidth?this.fixedWidth-r:Number.MAX_VALUE,a=-1;this.ellipsized=!1,this.ellipsisLength=0;for(var c=0,l=this.text.length;l>c;++c){var u=this.transformLetter(this.text[c]),d=this.getLetterUrl(u),f=null,g=!1;if("space"===u?(g=!0,t+=this.getSpaceSize?this.getSpaceSize():0):f=this.engine.resources.image(d),f?(t+=f.width,c!==this.text.length-1&&(t+=this.getKerning(u)),e=Math.max(f.height,e)):(t+=this.getKerning(u),g||(i=!1)),0>a&&t>=o&&(a=c-1,o=t),t>h){this.ellipsized=!0,this.ellipsisLength=a,t=o;break}}return i&&(this.measuredText=this.text),this.measuredWidth=t,this.height=e,this.trigger("textchanged"),{width:this.measuredWidth,height:this.height}},onrender:function(t){var e=~~(this.x+.5),i=~~(this.y+.5),s=0;this.measuredText!==this.text&&this.align!==void 0&&this.measure();var n=e;if(""+this.text===this.text){"right"===this.align?(n=e-this.measuredWidth,this.centerX=this.measuredWidth):"center"===this.align&&(n=e-this.measuredWidth/2,this.centerX=this.measuredWidth/2),this.width=this.measuredWidth;for(var r=this.ellipsized?this.ellipsisLength:this.text.length,h=0;r>h;++h){var o=this.text[h];o=this.transformLetter(o),"space"===o&&(s+=this.getSpaceSize?this.getSpaceSize():0);var a=this.engine.resources.image(this.getLetterUrl(o));a?(t.drawImage(a.img,a.x,a.y,a.width,a.height,n+s,i,a.width,a.height),s+=a.width,s+=this.getKerning(o)):s+=this.getKerning(o)}if(this.ellipsized)for(var h=0;3>h;++h){var o="period";o=this.transformLetter(o);var a=this.engine.resources.image(this.getLetterUrl(o));a?(t.drawImage(a.img,a.x,a.y,a.width,a.height,n+s,i,a.width,a.height),s+=a.width,s+=this.getKerning(o)):s+=this.getKerning(o)}}}}),i=new Behaviour("canvas-text",{defaults:{scaleX:1,scaleY:1,rotation:0},setText:function(t){this.text=t},measure:function(t){!t&&document&&(t=document.createElement("canvas").getContext("2d")),this.font&&(t.font=this.font);var e=t.measureText(this.text);return this.measuredText=this.text,this.measuredWidth=e.width,this.height=e.height,this.trigger("textchanged"),{width:this.measuredWidth,height:this.height}},onrender:function(t){var e=~~(this.x+.5),i=~~(this.y+.5)+~~this.height;this.font&&(t.font=this.font),this.color&&(t.fillStyle=this.color),this.measuredText!==this.text&&this.measure(t);var s=e;""+this.text===this.text&&("right"===this.align?(s=e-this.measuredWidth,this.centerX=this.measuredWidth):"center"===this.align&&(s=e-this.measuredWidth/2,this.centerX=this.measuredWidth/2),this.width=this.measuredWidth,this.strokeStyle&&(t.lineWidth=6,t.strokeStyle=this.strokeStyle,t.strokeText(this.text,s,i)),t.fillText(this.text,s,i))}});t.CanvasText=i,t.Text=e}("undefined"!=typeof exports?exports:window),function(t){function e(t){for(var e=t.getObjects(),i=0,s=e.length;s>i;++i){var n=e[i];n.collided=!1,n.collisions={}}for(var i=0,s=e.length;s>i;++i)for(var r=e[i],h=r.getBoundingBox(),o=i+1;s>o;++o){var n=e[o];if(n!==r&&r.collidesWith(n)&&n.collidesWith(r)&&!r.collisions.hasOwnProperty(n.id)){var a=n.getBoundingBox();(r.checkAABBIntersection(h,a)||r.checkAABBIntersection(a,h))&&(r.collisions[n.id]=n,n.collisions[r.id]=r)}}for(var i=0,s=e.length;s>i;++i){var n=e[i];for(var o in n.collisions)n.collided=!0,n.collisions.hasOwnProperty(o)&&n.trigger("collision",n.collisions[o])}}var i=new Behaviour("collider",{ongizmos:function(t){var e=this.getBoundingBox();this.collided?(t.strokeStyle="#ff0000",t.lineWidth=4):(t.strokeStyle="#00ff00",t.lineWidth=2),t.strokeRect(e.x,e.y,e.width,e.height)},checkAABBIntersection:function(t,e){for(var i=e.x,s=e.x+e.width,n=e.y,r=e.y+e.height,h=[[t.x,t.y],[t.x+t.width,t.y],[t.x,t.y+t.height],[t.x+t.width,t.y+t.height]],o=0;4>o;++o){var a=h[o],c=a[0],l=a[1];if(c>=i&&s>=c&&l>=n&&r>=l)return!0}return!1},getBoundingBox:function(){var t=~~this.x-~~this.centerX,e=~~this.y-~~this.centerY;return{x:t,y:e,width:this.width,height:this.height}},collidesWith:function(){return!0}});i.handleCollisions=e,t.Collider=i}("undefined"!=typeof exports?exports:window),function(t){var e={};e.fadeInOut=function(t,e){return function(i){var s=e.direction||"out",n=e.duration||.5,r=e.color||"#000",h=game.object({alpha:"in"===s?1:0,x:0,y:0,width:t.engine.view.width,height:t.engine.view.height,onrender:function(t){t.fillStyle=r,t.fillRect(this.x,this.y,this.width,this.height)}});h.ease({alpha:1-h.alpha},n,0===h.alpha?Easing.easeOut:Easing.easeIn,function(){i(),h.remove()}),t.addChild(h)}};var i=new Behaviour("scene",{onrender:function(t){this.background&&(t.fillStyle=this.background,t.fillRect(0,0,this.engine.view.width,this.engine.view.height))},onentering:function(t){function e(){i.trigger("enter"),t()}var i=this,s=this.transitionIn();s?s.call(this,e):e()},onleaving:function(t){function e(){i.trigger("leave"),t(),i.leaving=!0}var i=this;i.leaving=!0;var s=this.transitionOut();s?s.call(this,e):e()},transitionIn:function(){return e.fadeInOut(this,{direction:"in",color:"#000",duration:.5})},transitionOut:function(){return e.fadeInOut(this,{direction:"out",color:"#000",duration:.5})},removeFromStack:function(){this.engine&&this.engine.removeScene(this)}});t.Scene=i,t.Transition=e}("undefined"!=typeof exports?exports:window),function(t){var e=200,i=new Behaviour("scroller",{defaults:{offsetX:0,offsetY:0,clip:!0},init:function(){this._lastDownEvent=null,this._lastTouchEvent=null,this._velocity=null},ontick:function(){var t=!1;this.contentWidth=0,this.contentHeight=0;for(var e=0;this._children.length>e;++e){var i=this._children[e],s=i.x-~~i.centerX+~~i.width,n=i.y-~~i.centerY+~~i.height;this.contentWidth=Math.max(this.contentWidth,s),this.contentHeight=Math.max(this.contentHeight,n)}this._targetOffsetX&&this.offsetX!==this._targetOffsetX&&(t=!0,this.offsetX=1>Math.abs(this.offsetX-this._targetOffsetX)?this._targetOffsetX:this.offsetX+(this._targetOffsetX-this.offsetX)/8),this._targetOffsetY&&this.offsetY!==this._targetOffsetY&&(t=!0,this.offsetY=1>Math.abs(this.offsetY-this._targetOffsetY)?this._targetOffsetY:this.offsetY+(this._targetOffsetY-this.offsetY)/8),t&&this.updateOffsets(this.offsetX,this.offsetY)},isInBounds:function(t,e){for(var i=this.x-~~this.centerX,s=this.y-~~this.centerY,n=this.parent;n;)i+=n.x,s+=n.y,n=n.parent;var r=t-i,h=e-s;return r>=0&&~~this.width>r&&h>=0&&~~this.height>h?!0:!1},boundedOffsets:function(t,e){var i=this.scaleX||1,s=this.scaleY||1;return t=Math.max((this.width-this.contentWidth)*i,t),e=Math.max((this.height-this.contentHeight)*s,e),t=Math.min(0,t),e=Math.min(0,e),this.trigger("scrollChanged",t,e),[t,e]},updateOffsets:function(t,e){var i=this.boundedOffsets(t,e);this.offsetX=i[0],this.offsetY=i[1]},_markTouchEvent:function(t,e){var i=+new Date;if(this._lastTouchEvent){var s=i-this._lastTouchEvent.ts,n=this._lastTouchEvent.x-t,r=this._lastTouchEvent.y-e;s=s||1,s/=2;var h=this._velocity;this._velocity={x:n/s,y:r/s},h&&(this._velocity={x:(this._velocity.x+h.y)/2,y:(this._velocity.y+h.y)/2})}this._lastTouchEvent={x:t,y:e,ts:i}},ontouchstart:function(t,i,s){if(!s.cancelled){this._velocity=null,this._lastTouchEvent=null,this._markTouchEvent(t,i);var n=+new Date;if(this._lastDownEvent){var r=n-this._lastDownEvent;if(e>r)return this.trigger("doubletap",t,i),this._lastDownEvent=null,void 0}this._lastDownEvent=n,this.isInBounds(t,i)?(this.isDown=!0,this.touched=!0,this.initialX=t,this.initialY=i,this.initialOffsetX=~~this.offsetX,this.initialOffsetY=~~this.offsetY):(this.isDown=!1,this.touched=!1)}},ontouchmove:function(t,e,i){i.cancelled||(this._markTouchEvent(t,e),this.isDown&&this.updateOffsets(t-this.initialX+this.initialOffsetX,e-this.initialY+this.initialOffsetY))},ontouchend:function(t,e,i){if(!i.cancelled){if(this._markTouchEvent(t,e),this.isDown&&(this.updateOffsets(t-this.initialX+this.initialOffsetX,e-this.initialY+this.initialOffsetY),this._velocity)){var s=this.boundedOffsets(this.offsetX-100*this._velocity.x,this.offsetY-100*this._velocity.y);this._targetOffsetX=s[0],this._targetOffsetY=s[1]}this.touched=!1,this.isDown=!1}}});t.Scroller=i}("undefined"!=typeof exports?exports:window);var GameObject,Behaviour;if("undefined"!=typeof require){var utils=require("./utils.js"),resources=require("./resources.js"),timers=require("./timers.js"),gameObject=require("./game-object.js");Utils=utils.Utils,Events=utils.Events,Resources=resources.Resources,Timer=timers.Timer,ClockTimer=timers.ClockTimer,GameObject=gameObject.GameObject,Behaviour=gameObject.Behaviour}(function(t,e){var i=4,s=Utils.extendTo(GameObject,function(t){var n=this;this["super"]({},this),this.engine=this,this.entityCount=0,this.accelerationHistory=[];var r,h,o,a=navigator?navigator.userAgent:"Android";if((o=/\bCPU.*OS (\d+(_\d+)?)/i.exec(a))?(r="ios",h=o[1].replace("_",".")):(o=/\bAndroid (\d+(\.\d+)?)/.exec(a))&&(r="android",h=o[1]),+new Date,e.ondevicemotion=function(t){var e=t.accelerationIncludingGravity.x,s=-t.accelerationIncludingGravity.y,h=t.accelerationIncludingGravity.z;-10>e||e>10||(e=e||0,s=s||0,h=h||0,"android"===r&&(e=-e,s=-s),e=Math.min(1,Math.max(-1,e/10)),s=Math.min(1,Math.max(-1,s/10)),h=Math.min(1,Math.max(-1,h/10)),n.accelerationHistory.push({x:e,y:s,z:h}),n.accelerationHistory.length>i&&n.accelerationHistory.shift())},e.ondeviceorientation=function(t){var e={alpha:t.alpha,beta:t.beta,gamma:t.gamma};n.orientation&&(e.alpha=(e.alpha+n.orientation.alpha)/2,e.beta=(e.beta+n.orientation.beta)/2,e.gamma=(e.gamma+n.orientation.gamma)/2),n.orientation=e
},this.on("gizmos",function(t){var e=0;t.font="bold 26px sans-serif",t.fillStyle="#666",t.fillText(n.fps(),4,e+=30),t.font="bold 26px sans-serif",t.fillStyle="#ff4444",t.fillText(n.accelerationX,4,e+=30),t.font="bold 26px sans-serif",t.fillStyle="#44ff44",t.fillText(n.smoothAccelerationX,4,e+=30)}),this.resources=new Resources,this.timer=t||new ClockTimer,this.timer.setCallback(function(t,e){n._tick(t,e)}),this.activeScene=null,this._sceneHistory=[],this._display={width:960,height:640},this.view={scaleMode:s.ScaleMode.FillHeight,x:0,y:0,width:640,height:960},cards&&cards._&&cards._.bridge){var c=cards._.bridge("Browser");c&&c.forceRepaint&&(this.browser=c,this.hasForceRepaint=!0)}this.backgroundColor="#ffffff",this.touches=[],this.touch={},this.gravity=2800,this._objects={},this._behaviours={},this._fixedStep=17,this._skipThreshold=null,this._renderThreshold=null,this._timer=t,this._timestamp=0,this._remaining=0,this._lastRenderTime=0,this.debugging=!1,this._fps=-1,this._renderings=0,this._lastFpsUpdate=-1,this._updateTimes=[],this._renderTimes=[];for(var l=0;s.DEFAULT_BEHAVIOURS.length>l;++l){var u=s.DEFAULT_BEHAVIOURS[l];this.behaviour(u._name,u._definition,this)}this.on("tick",function(){function t(t,e){for(var i=t[t.length-1][e],s=0;t.length>s;++s)i=(t[s][e]+i)/2;return i}if(n.accelerationHistory.length>0){var e=n.accelerationHistory[n.accelerationHistory.length-1];n.accelerationX=e.x,n.accelerationY=e.y,n.accelerationZ=e.z;var i=t(n.accelerationHistory,"x"),s=t(n.accelerationHistory,"y"),r=t(n.accelerationHistory,"z");n.accelerationXPre=(i+(n.accelerationXPre?n.accelerationXPre:0))/2,n.accelerationYPre=(s+(n.accelerationYPre?n.accelerationYPre:0))/2,n.accelerationZPre=(r+(n.accelerationZPre?n.accelerationZPre:0))/2,n.smoothAccelerationX=n.accelerationXPre,n.smoothAccelerationY=n.accelerationYPre,n.smoothAccelerationZ=n.accelerationZPre}var h=n.touch,o={};o.cancelled=!1,!h.wasDown&&h.isDown?h.wasDown=!0:h.wasDown&&h.isDown?n.trigger("touchmove",h.x,h.y,o):h.wasDown&&!h.isDown&&(h.wasDown=!1,n.trigger("touchend",h.x,h.y,o))})});s.prototype.removeScene=function(t){for(var e=0;this._sceneHistory.length>e;++e)if(this._sceneHistory[e]===t){this._sceneHistory.splice(e,1);break}},s.prototype.backScene=function(){var t=this._sceneHistory.pop();this.changeScene(t,!0)},s.prototype.changeScene=function(t,e){function i(i){var r=0;if(n){var h=!e||i!==void 0&&!i;r=s.indexOfChild(n),n.parent.removeChild(n,!h),h&&s._sceneHistory.push(n)}s.insertChild(t,r),s.activeScene=t,t.trigger("entering",function(){})}var s=this,n=this.activeScene;n?n.trigger("leaving",i):i()},s.ScaleMode={Fixed:"fixed",Center:"center",Fill:"fill",FillWidth:"fill-width",FillHeight:"fill-height"},s.FPS_60=1e3/60/1e3,s.FPS_30=1e3/30/1e3,s.FPS_10=.1,s.prototype.updateDisplay=function(t,e){var i=this._display.width;this._display.height,this._display.width=t,this._display.height=e,(this._display.width!==i||this._display.height!==e)&&(this._display.changed=!0,this._fixViewSize())},s.prototype.fps=function(){return Math.round(this._fps)},s.prototype.setCanvas=function(t){function e(e){var i=e.clientX,s=e.clientY;return i=o.view.width*i/t.clientWidth,s=o.view.height*s/t.clientHeight,[i,s]}function i(t){var i=t.changedTouches,s=e(i?i[0]:t),n=s[0],r=s[1];return[n,r]}function s(t,i,s){var n=t.changedTouches;if(n)for(var r=0;n.length>r;++r){var h={},a=n[r];if(a)if(i){var c=e(a);h.x=c[0],h.y=c[1],h.isDown=i,h.clicked=s,o.touches[r]=h}else o.touches[r]=null}}function n(t){var e=i(t.changedTouches?t.changedTouches[0]:t),n={};return o.touch.x=e[0],o.touch.y=e[1],o.touch.isDown=!0,o.touch.wasDown=!1,o.touch.clicked=!0,3===t.touches.length&&(o.touch.trippleTapped=!0,o.debugging=!o.debugging,console.log(o.debugLog())),s(t,!0,!0),t.preventDefault(),n.cancelled=!1,o.trigger("touchstart",o.touch.x,o.touch.y,n),!1}function r(t){var e=i(t.changedTouches?t.changedTouches[0]:t);return o.touch.x=e[0],o.touch.y=e[1],o.touch.wasDown=!0,s(t,!0,!1),t.preventDefault(),!1}function h(t){var e=i(t.changedTouches?t.changedTouches[0]:t);return o.touch.x=e[0],o.touch.y=e[1],o.touch.isDown=!1,s(t,!1,!1),o._lastX=-1,o._lastY=-1,t.preventDefault(),!1}var o=this;this.canvas=t,this.context=this.canvas.getContext("2d"),this._display.changed=!0,t.addEventListener("touchstart",n,!1),t.addEventListener("touchmove",r,!1),t.addEventListener("touchend",h,!1)},s.prototype.setSize=function(t,e){this.view.width=t,this.view.height=e,this._display.changed=!0},s.prototype._fixViewSize=function(){if(this._display.changed){switch(this._display.changed=!1,this.view.scaleMode){case s.ScaleMode.Fixed:break;case s.ScaleMode.Center:this.view.xoffset=Math.round((this._display.width-this.view.width)/2),this.view.yoffset=Math.round((this._display.height-this.view.height)/2);break;case s.ScaleMode.Fill:this.view.xoffset=0,this.view.yoffset=0,this.view.width=this._display.width,this.view.height=this._display.height;break;case s.ScaleMode.FillWidth:this.view.xoffset=0,this.view.yoffset=0,this.view.width=Math.round(this._display.width*this.view.height/this._display.height);break;case s.ScaleMode.FillHeight:this.view.xoffset=0,this.view.yoffset=0,this.view.height=Math.round(this._display.height*this.view.width/this._display.width)}this.canvas.width=this.view.width,this.canvas.height=this.view.height,this.trigger("resize",this.view.width,this.view.height),this._isReady||(this._isReady=!0,this.trigger("ready"))}},s.prototype.ready=function(t){this._isReady?t.call(this):this.once("ready",t)};var n=[];s.prototype._tick=function(t,i){function s(){if(h=+new Date,n.length>12){var t=[].concat(n);n.length=0,e.setTimeout(function(){console.log(t.join("\n"))},0)}}var r,h,o=this,a=t,c=0,l=+new Date,u=!1;if(this._eventTimeline={},this._eventDeltas={},this._eventStack={},i(),a*=o.multiplier||1,void 0!==typeof this.canvas&&o.updateDisplay(this.canvas.clientWidth,this.canvas.clientHeight),o._fixedStep)for(o._remaining+=a;o._remaining>=o._fixedStep;)o._timestamp+=o._fixedStep/1e3,u=!0,o.trigger("subtick",o._fixedStep/1e3,o._timestamp),++c,o._remaining-=o._fixedStep;else o._remaining=a,a=o._remaining/1e3,o._remaining=0,o._timestamp+=a,u=!0,o.trigger("subtick",a,o._timestamp);if(r=+new Date,u&&(o._updateTimes.unshift(r-l),o._updateTimes.length>=10&&o._updateTimes.pop()),u&&o.context){o._render(o.context);var d=+new Date;if(d-o._lastFpsUpdate>1e3){var f=o._renderings;0>o._fps&&(o._fps=f),o._fps=(4*f+o._fps)/5,o._renderings=0,o._lastFpsUpdate=d}this.hasForceRepaint,s()}else s()},s.prototype._render=function(t){var e,i=+new Date;this._lastRenderTime=this._timestamp,t.setTransform(1,0,0,1,0,0),t.fillStyle=this.background,t.fillRect(0,0,this.view.width,this.view.height),this.trigger("subrender",t),++this._renderings,e=+new Date,this._renderTimes.unshift(e-i),this._renderTimes.length>=10&&this._renderTimes.pop(),this.debugging&&(t.setTransform(1,0,0,1,0,0),this.trigger("gizmos",t))},s.prototype.object=function(t){var e=Array.prototype.slice.call(arguments,0);if(e.length>0){var i=e[e.length-1];i instanceof Behaviour||""+i===i?t=null:(t=i,e.pop())}var s=new GameObject(e,t,this);return this._addObject(s),s.trigger("attach",this),s},s.prototype.behaviour=function(t,e){if(this._behaviours.hasOwnProperty(t))return this._behaviours[t];var i=new Behaviour(t,e,this);return this._behaviours[t]=i,i},s.prototype.start=function(){this.timer.start()},s.prototype.getObject=function(t){return this._objects[t]},s.prototype._addObject=function(t){var e=!this._objects.hasOwnProperty(t.id);if(this._objects[t.id]=t,e){this.entityCount++;var i=t._behaviours;for(var s in i)i.hasOwnProperty(s)&&i[s].applyBehaviour(t)}},s.prototype.removeObject=function(t){if(this._objects.hasOwnProperty(t.id)){this.entityCount--,delete this._objects[t.id];var e=t._behaviours;for(var i in e)e.hasOwnProperty(i)&&e[i].removeBehaviour(t)}},t.Game=s,t.GameObject=GameObject,t.Behaviour=Behaviour})("undefined"!=typeof exports?exports:window,"undefined"!=typeof window?window:exports),Game.DEFAULT_BEHAVIOURS=[Sprite,CanvasText,Text,Mass,Collider,Accelerometer,Orientation,Scene,Scroller,GameButton];